#!/usr/bin/env bash

# Synopsis:
# Test the track's exercises.
# 
# At a minimum, this file must check if the example/exemplar solution of each 
# Practice/Concept Exercise passes the exercise's tests.
#
# To check this, you usually have to (temporarily) replace the exercise's solution files
# with its exemplar/example files.
#
# If your track uses skipped tests, make sure to (temporarily) enable these tests
# before running the tests.
#
# The path to the solution/example/exemplar files can be found in the exercise's
# .meta/config.json file, or possibly inferred from the exercise's directory name.

# Example:
# ./bin/test

# Verify the Concept Exercises
for concept_exercise_dir in ./exercises/concept/*/; do
    if [ -d $concept_exercise_dir ]; then
        echo "Checking $(basename "${concept_exercise_dir}") exercise..."
        # TODO: run command to verify that the exemplar solution passes the tests
    fi
done

EXIT_CODE=0

# Verify the Practice Exercises
for practice_exercise_dir in ./exercises/practice/*/; do
    if [ -d $practice_exercise_dir ]; then
        echo "Checking $(basename "${practice_exercise_dir}") exercise..."
	8th -f ${practice_exercise_dir}.meta/example.8th -f ${practice_exercise_dir}test-words.8th -f ${practice_exercise_dir}$(basename "${practice_exercise_dir}")-tests.8th > /tmp/test.out 
        # TODO: run command to verify that the example solution passes the tests
        if [ -f /tmp/test.out ] && [ ! -s /tmp/test.out ]; then
            EXIT_CODE=1
            break
        fi
        grep -E 'Exception|\.\.\. FAIL' /tmp/test.out
        if [ $? -eq 0 ]; then 
            EXIT_CODE=1
            break
        fi
    fi
done
exit ${EXIT_CODE}
